cd $(dirname $0)

# Make sure we are initialized. This will insure a bare repo 
# for us to clone a local repo from
./vendor.init > /dev/null

# Clone a local local bats because the test will remove the default
bare=${HOME}/.bob/vendor/git-bare/github.com/sstephenson/bats.git 
repo=${PWD}/bats.repo.tmp
git clone ${bare} ${repo}

# Put it on the path
export PATH=${repo}/bin:${PATH}

# Run the tests
bats ./tests/test-main.bats

# expensive test
if [[ X$1 == X-f ]]; then
	bats ./tests/test-bare.bats
fi

# Cleanup
rm -rf ${repo}
